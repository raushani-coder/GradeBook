<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GradeBook â€“ Student Result System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-5">

  <!-- Header -->
  <div class="text-center mb-4">
    <h1 class="fw-bold text-primary">GradeBook</h1>
    <p class="text-muted">Student Result Management System</p>
  </div>

  <!-- Form Card -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Add / Update Student</h5>

      <form id="resultForm" class="row g-3">
        <input type="hidden" id="editIndex">

        <div class="col-md-4">
          <input type="text" id="name" class="form-control" placeholder="Student Name" required>
        </div>

        <div class="col-md-2">
          <input type="number" id="m1" class="form-control" placeholder="Maths" min="0" max="100" required>
        </div>

        <div class="col-md-2">
          <input type="number" id="m2" class="form-control" placeholder="Science" min="0" max="100" required>
        </div>

        <div class="col-md-2">
          <input type="number" id="m3" class="form-control" placeholder="English" min="0" max="100" required>
        </div>

        <div class="col-md-2 d-grid">
          <button class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Table Card -->
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between mb-3">
        <h5 class="card-title">Result Table</h5>
        <button class="btn btn-outline-success btn-sm" onclick="exportCSV()">Export CSV</button>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>Name</th>
              <th>Total</th>
              <th>Percentage</th>
              <th>Grade</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="resultTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-center mt-5">
    <p class="mb-1">Developed by <strong>Raushani Kumari</strong></p>
    <a href="https://github.com/raushani-coder/" target="_blank" class="me-3">GitHub</a>
    <a href="https://www.linkedin.com/in/raushanikumari97" target="_blank">LinkedIn</a>
  </footer>

</div>

<script>
const form = document.getElementById('resultForm');
const table = document.getElementById('resultTable');
const editIndex = document.getElementById('editIndex');

let students = JSON.parse(localStorage.getItem('gradebook-data')) || [];

function calculateGrade(percent) {
  if (percent >= 90) return 'A+';
  if (percent >= 75) return 'A';
  if (percent >= 60) return 'B';
  if (percent >= 45) return 'C';
  return 'Fail';
}

form.addEventListener('submit', e => {
  e.preventDefault();

  const name = document.getElementById('name').value;
  const m1 = +document.getElementById('m1').value;
  const m2 = +document.getElementById('m2').value;
  const m3 = +document.getElementById('m3').value;

  if ([m1, m2, m3].some(m => m < 0 || m > 100)) {
    alert('Marks must be between 0 and 100');
    return;
  }

  const total = m1 + m2 + m3;
  const percent = (total / 300 * 100).toFixed(2);
  const grade = calculateGrade(percent);

  const student = { name, total, percent, grade };

  if (editIndex.value !== '') {
    students[editIndex.value] = student;
    editIndex.value = '';
  } else {
    students.push(student);
  }

  saveAndRender();
  form.reset();
});

function renderTable() {
  table.innerHTML = '';
  students.forEach((s, i) => {
    table.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${s.name}</td>
        <td>${s.total}</td>
        <td>${s.percent}%</td>
        <td>${s.grade}</td>
        <td>
          <button class="btn btn-sm btn-warning me-1" onclick="editStudent(${i})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteStudent(${i})">Delete</button>
        </td>
      </tr>
    `;
  });
}

function editStudent(index) {
  const s = students[index];
  document.getElementById('name').value = s.name;
  editIndex.value = index;
}

function deleteStudent(index) {
  if (confirm('Delete this record?')) {
    students.splice(index, 1);
    saveAndRender();
  }
}

function saveAndRender() {
  localStorage.setItem('gradebook-data', JSON.stringify(students));
  renderTable();
}

function exportCSV() {
  let csv = 'Name,Total,Percentage,Grade\n';
  students.forEach(s => {
    csv += `${s.name},${s.total},${s.percent},${s.grade}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = 'results.csv';
  a.click();
}

saveAndRender();
</script>

</body>
</html>
